<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<link rel="icon" href="neuille/neuille_svgo.svg" type="image/svg+xml">
	<link rel="stylesheet" href="styles.css">
	<title>Into the Abyss - Based.meme</title>
	<script src="theme.js"></script>
</head>

<body id="top">
	<header>
		<div class="logo">
			<a href="index.php">
				<h1 class="glitch" data-text="Based.meme">Based.meme</h1>
			</a>
		</div>
		<form class="search" action="search.php" method="GET">
			<input type="search" name="query" value="<?= htmlspecialchars($query) ?>">
			<button type="submit">🔍</button>
		</form>
		<nav>
			<button id="themeToggle">🌙</button>
			<a href="profile.php" class="btn btn-login">Profile</a>
			<a href="logout.php" class="btn btn-signup">Logout</a>
		</nav>
	</header>
	<main class="main-aby">
		<section class="sec-aby">
			<div class="title-aby">
				<h2 class="tagline">Into the Abyss</h2>
				<p class="subtitle">Into the Abyss allows you to search for memes</p>
			</div>
			<div class="formulaire-aby">
				<form class="formabyss" action="search.php" method="GET">
					<div class="user-insert">
						<div class="auth-form">
							<br>
							<label for="query">MEME</label>
							<input type="text" id="query" name="query" value="<?= htmlspecialchars($query) ?>">
							<br>
							<br>
						</div>
						<div class="meme-tag-container">
							<label>TAGS</label>
							<div class="tag-container"><?php if (!empty($tags)): ?><?php foreach ($tags as $tag): ?><input type="checkbox" name="tags[]" value="<?= htmlspecialchars($tag['slug']) ?>" id="tag-<?= htmlspecialchars($tag['slug']) ?>" <?= in_array($tag['slug'], $selected_tags) ? 'checked' : '' ?>>
								<label for="tag-<?= htmlspecialchars($tag['slug']) ?>"><?= htmlspecialchars($tag['name']) ?></label><?php endforeach; ?><?php endif; ?>
							</div>
						</div>
					</div>
					<button type="submit" class="btn-aby">Find</button>
				</form>
			</div>
		</section>
		<section>
			<br>
			<h2>📄 Results:</h2>
			<br><?php if (isset($_SESSION['search_error'])): ?><div class="error-banner"><?= htmlspecialchars($_SESSION['search_error']); ?></div><?php unset($_SESSION['search_error']); ?><?php endif; ?><?php if ($query !== '' || !empty($selected_tags)): ?><?php if (empty($results)): ?><div class="empty-state">
				<h3>No memes found</h3>
			</div><?php else: ?><div class="meme-grid"><?php foreach ($results as $meme): ?><a href="meme.php?id=<?= htmlspecialchars($meme['meme_id']) ?>" class="meme-card-link">
					<div class="meme-card">
						<div class="meme-image"><img src="<?= htmlspecialchars($meme["media_url"]) ?>" alt="<?= htmlspecialchars($meme["title"]) ?>">
							<div class="creator-badge">@<?= htmlspecialchars($meme["creator"]) ?></div>
						</div>
						<div class="meme-info">
							<h4><?= htmlspecialchars($meme["title"]) ?></h4><?php if (!empty($meme['tags'])): ?><div class="tag-list"><?php foreach ($meme["tags"] as $tag_name): ?><span class="tag"><?= htmlspecialchars($tag_name) ?></span><?php endforeach; ?></div><?php endif; ?><div class="meme-stats">
								<span>❤️ <?= number_format($meme["like_count"]) ?></span>
								<span>💬 <?= number_format($meme["comment_count"]) ?></span>
								<span>🌶️ <?= number_format($meme['spicyness']) * 100 ?></span>
							</div>
						</div>
					</div>
				</a><?php endforeach; ?></div><?php endif; ?><?php else: ?><p>Enter a query or select tags to start searching.</p><?php endif; ?>
		</section>
	</main>
	<footer>
		<div class="footer-content">
			<div class="footer-links">
				<a href="about.html">About</a>
				<a href="privacy_policy.html">Privacy Policy</a>
				<a href="terms_of_service.html">Terms of Service</a>
				<a href="contact.php">Contact</a>
			</div>
			<p class="copyright">© 2025 Based.meme | All rights reserved | No normies allowed.</p>
			<a href="#top" id="scrollToTop">⬆️</a>
		</div>
	</footer>
</body>

</html>